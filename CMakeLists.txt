cmake_minimum_required(VERSION 3.15)
project(stdx CXX)

# ------------------------------------------------------------------------------
# 2) Set C++ standard to 17
# ------------------------------------------------------------------------------
set(CMAKE_CXX_STANDARD 17)
set(CMAKE_CXX_STANDARD_REQUIRED ON)

# ------------------------------------------------------------------------------
# 3) Default build type is Debug if none specified
# ------------------------------------------------------------------------------
if(NOT CMAKE_BUILD_TYPE)
    set(CMAKE_BUILD_TYPE Debug)
endif()

# ------------------------------------------------------------------------------
# 4) Output folders under build/<build_type>/
# ------------------------------------------------------------------------------
set(CMAKE_ARCHIVE_OUTPUT_DIRECTORY 
    "${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE}/lib")
set(CMAKE_LIBRARY_OUTPUT_DIRECTORY 
    "${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE}/lib")
set(CMAKE_RUNTIME_OUTPUT_DIRECTORY 
    "${CMAKE_BINARY_DIR}/${CMAKE_BUILD_TYPE}/bin")

# ------------------------------------------------------------------------------
# 5) Conan Toolchain Include (generated by conan install)
# ------------------------------------------------------------------------------
include("${CMAKE_BINARY_DIR}/conan_toolchain.cmake" OPTIONAL)

# ------------------------------------------------------------------------------
# 6) CTest setup
# ------------------------------------------------------------------------------
include(CTest)
enable_testing()

# ------------------------------------------------------------------------------
# 7) Options to enable/disable modules
# ------------------------------------------------------------------------------
option(STDX_ENABLE_FLAG   "Enable 'flag' module"   ON)
option(STDX_ENABLE_LOGGER "Enable 'logger' module" ON)

# If Conan sets these as preprocessor definitions, you can override:
if(DEFINED STDX_ENABLE_FLAG)
    set(STDX_ENABLE_FLAG ${STDX_ENABLE_FLAG})
endif()

if(DEFINED STDX_ENABLE_LOGGER)
    set(STDX_ENABLE_LOGGER ${STDX_ENABLE_LOGGER})
endif()

# ------------------------------------------------------------------------------
# 8) Add subdirectories for each module
# ------------------------------------------------------------------------------
if(STDX_ENABLE_FLAG)
    add_subdirectory(modules/flag)
endif()

if(STDX_ENABLE_LOGGER)
    add_subdirectory(modules/logger)
endif()

# ------------------------------------------------------------------------------
# Install the shared "utils.hpp" if you want a system-wide "make install"
# ------------------------------------------------------------------------------
install(FILES include/stdx/utils.hpp
    DESTINATION include/stdx
)
